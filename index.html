<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
    <title>S360</title>
    <style type="text/css">
        /**
         * Example of an initial loading indicator.
         * It is recommended to keep this as minimal as possible to provide instant feedback
         * while other resources are still being loaded for the first time
         */
        html, body {
            background: url("resources/images/loadingimage-r2.png") no-repeat center center;
            background-size: cover;
        }

        #appLoadingIndicator {
            position: absolute;
            top: 100%;
            margin-top: -15px;
            text-align: center;
            width: 100%;
            height: 30px;
            -webkit-animation-name: appLoadingIndicator;
            -webkit-animation-duration: 5s;
            -webkit-animation-iteration-count: infinite;
            -webkit-animation-direction: linear;
        }

            #appLoadingIndicator > * {
                background-color: #e19b20;
                display: inline-block;
                height: 10px;
                width: 100%;
            }

        @-webkit-keyframes appLoadingIndicator {
            from {
                width: 0%;
            }

            25% {
                width: 25%;
            }

            50% {
                width: 50%;
            }

            75% {
                width: 75%;
            }

            to {
                width: 100%;
            }
        }
    </style>
    <!-- The line below must be kept intact for Sencha Command to build your application -->
    <script src="phonegap.js"></script>
    <script src="splashscreen.js"></script>
    <script type="text/javascript" src="plupload.full.min.js"></script>
    <script src="cordova.js"></script>
    <!-- cordova facebook plugin -->
    <script src="cdv-plugin-fb-connect.js"></script>
    <!-- facebook js sdk -->
    <script src="facebook-js-sdk.js"></script>
    <!--<script src="src/canvas-to-blob.min.js"></script>-->
    <script id="microloader" type="text/javascript" src="touch/microloader/development.js"></script>



</head>
<body style="background-color: #1f88c0">
        
        <div id="data">loading ...</div>
        <!--<script src="http://localhost:8080/target/target-script-min.js#anonymous"></script>-->
        <div id="fb-root"></div>
               
        <script>
             <!-- These are the notifications that are displayed to the user through pop-ups if the above JS files does not exist in the same directory-->
    if ((typeof cordova == 'undefined') && (typeof Cordova == 'undefined')) alert('Cordova variable does not exist. Check that you have included cordova.js correctly');
    if (typeof CDV == 'undefined') alert('CDV variable does not exist. Check that you have included cdv-plugin-fb-connect.js correctly');
    if (typeof FB == 'undefined') alert('FB variable does not exist. Check that you have included the Facebook JS SDK file.');

    //window.FBConfig = {};
    //window.FBConfig.rootDomain = "http://uat.smiley360.com/ws/includes/";
    //window.FBConfig.domain = window.FBConfig.rootDomain + "oauth/";
    //window.FBConfig.appId = '104171846376854';
    //var channelUrl = '//' + window.FBConfig.domain + 'channel.php';

    //FB.init({
    //    appId: '104171846376854',           // App ID from the app dashboard
    //    nativeInterface: CDV.FB,
    //    //channelUrl: channelUrl, // Channel file for x-domain comms
    //    status: true,           // Check Facebook Login status
    //    cookie: true,           // enable cookies to allow the server to access the session
    //    oauth: true,            // enable OAuth 2.0
    //    xfbml: false,           // Look for social plugins on the page
    //});

    FB.Event.subscribe('auth.login', function (response) {
        alert('auth.login event');
    });

    FB.Event.subscribe('auth.logout', function (response) {
        alert('auth.logout event');
    });

    FB.Event.subscribe('auth.sessionChange', function (response) {
        alert('auth.sessionChange event');
    });

    //FB.Event.subscribe('auth.statusChange', function (response) {
    //    alert('auth.statusChange event');
    //});

    function getSession() {
    alert("session: " + JSON.stringify(FB.getSession()));
    }

    function getLoginStatus() {
        FB.getLoginStatus(function (response) {
            if (response.status == 'connected') {
                alert('logged in');
            } else {
                alert('not logged in');
            }
        });
    }
    var friendIDs = [];
    var fdata;
    function me() {
        FB.api('/me/friends', { fields: 'id, name, picture' }, function (response) {
            if (response.error) {
                alert(JSON.stringify(response.error));
            } else {
                var data = document.getElementById('data');
                fdata = response.data;
                console.log("fdata: " + fdata.name);
                alert(JSON.stringify(fdata));
                response.data.forEach(function (item) {
                    var d = document.createElement('div');
                    d.innerHTML = "<img src=" + item.picture + "/>" + item.name;
                    data.appendChild(d);
                });
            }
            var friends = response.data;
            console.log(friends.length);
            for (var k = 0; k < friends.length && k < 200; k++) {
                var friend = friends[k];
                var index = 1;

                friendIDs[k] = friend.id;
                //friendsInfo[k] = friend;
            }
            console.log("friendId's: " + friendIDs);
        });
    }
    
    var user = [];

    var permissions = ['email', 'user_status'];

    //Detect when Facebook tells us that the user's session has been returned
    function me() {
        FB.Event.subscribe('auth.statusChange', handleStatusChange);
    }

    // Handle status changes
    function handleStatusChange(session) {
        console.log('Got the user\'s session: ' + JSON.stringify(session));

        if (session.authResponse) {
            //document.body.className = 'connected';

            //Fetch user's id, name, and picture
            FB.api('/me', {
                fields: 'name, picture'
            },
            function (response) {
                if (!response.error) {
                    //document.body.className = 'connected';
                    alert('connected');
                    user = response;

                    alert('Got the user\'s name and picture: ' + JSON.stringify(response.name));

                    //Update display of user name and picture
                    //if (document.getElementById('user-name')) {
                    //    document.getElementById('user-name').innerHTML = user.name;
                    //}
                    //if (document.getElementById('user-picture')) {
                    //    document.getElementById('user-picture').src = user.picture.data.url;
                    //}
                } else {
                    alert('not_connected');
                    console.log('Error getting user info: ' + JSON.stringify(response.error));
                    // Check for errors due to app being unininstalled
                    if (response.error.error_subcode && response.error.error_subcode == "458") {
                        setTimeout(function () {
                            alert("The app was removed. Please log in again.");
                        }, 0);
                    }
                    logout();
                }

                clearAction();
            });
        }
        else {
            alert('not_connected');

            clearAction();
        }
    }

    //Prompt the user to login and ask for the 'email' permission
    function login() {
        FB.login(null, { scope: 'email' });
    }

    //This will prompt the user to grant you acess to a given permission
    function promptPermission(permission) {
        FB.login(function (response) {
            if (response.authResponse) {
                checkUserPermissions(permission)
            }
        }, { scope: permission });
    }


    function uninstallApp() {
        FB.api('/me/permissions', 'DELETE',
          function (response) {
              //window.location.reload();
              // For may instead call logout to clear
              // cache data, ex: using in a PhoneGap app
              console.log('APP Uninstalled');
              logout();
          });
    }

    function logout() {
        FB.logout(function (response) {
            window.location.reload();
        });
    }

    //function login() {
    //    try {
    //        FB.login(
    //        function (response) {
    //            if (response.authResponse) {
    //                alert('logged in');
    //            } else {
    //                alert('not logged in');
    //            }
    //            alert(response.authResponse.accessToken);
    //            //if (response)
    //                //alert(JSON.stringify(response));
    //        }
    //                 ,
    //                 { scope: "email,publish_stream" }
    //                 );
    //    }
    //    catch(e) {
    //    //    FB.login(
    //    //function (response) {
    //    //    if (response.session) {
    //    //        alert('logged in1');
    //    //    } else {
    //    //        alert('not logged in1');
    //    //    }
    //    //    if (response)
    //    //        alert(JSON.stringify(response));
    //    //}
    //    //         ,
    //    //         { scope: "email,publish_stream" }
    //    //         );
    //    }

    //}


    //function facebookWallPost() {
    //    console.log('Debug 1');
    //    var params = {
    //        method: 'feed',
    //        name: 'Facebook Dialogs',
    //        link: 'https://developers.facebook.com/docs/reference/dialogs/',
    //        picture: 'http://fbrell.com/f8.jpg',
    //        caption: 'Reference Documentation',
    //        description: 'Dialogs provide a simple, consistent interface for applications to interface with users.'
    //    };
    //    console.log(params);
    //    FB.ui(params, function (obj) { console.log(obj); });
    //}

    //function publishStoryFriend() {
    //    randNum = Math.floor(Math.random() * friendIDs.length);

    //    var friendID = friendIDs[randNum];
    //    if (friendID == undefined) {
    //        alert('please click the me button to get a list of friends first');
    //    } else {
    //        console.log("friend id: " + friendID);
    //        console.log('Opening a dialog for friendID: ', friendID);
    //        var params = {
    //            method: 'feed',
    //            to: friendID.toString(),
    //            name: 'Facebook Dialogs',
    //            link: 'https://developers.facebook.com/docs/reference/dialogs/',
    //            picture: 'http://fbrell.com/f8.jpg',
    //            caption: 'Reference Documentation',
    //            description: 'Dialogs provide a simple, consistent interface for applications to interface with users.'
    //        };
    //        FB.ui(params, function (obj) { console.log(obj); });
    //    }
    //}

    document.addEventListener('deviceready', function () {
        try {
            //alert('Device is ready! Make sure you set your app_id below this alert.');
            FB.init({
                appId: "104171846376854",
                nativeInterface: CDV.FB,
                useCachedDialogs: false,
                status: true,           // Check Facebook Login status
                cookie: true,           // enable cookies to allow the server to access the session
                oauth: true,            // enable OAuth 2.0
                xfbml: false,  
            });
            document.getElementById('data').innerHTML = "";
            //var cbm = new window.plugins.clipboardManager;
            
            //    cbm.copy(
            //        "Success!!!",
            //        function (r) { alert("copy is successful") },
            //        function (e) { alert(e) }
            //    );
            
        } catch (e) {
            alert(e);
        }
    }, false);
            </script>
        <div id="log"></div>

    <div id="appLoadingIndicator">
        <div></div>
    </div>
</body>
</html>
